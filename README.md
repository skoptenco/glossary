## API Глоссарий терминов ВКР

---

Сборка и запуск сервисов осуществляется при помощи docker compose

```
    docker compose build
    docker compose up -d
```

#### Запуск сервисов без контейнеризации

Web

```
    uvicorn web.main:app --host 0.0.0.0 --port 8000 --reload
```

Grpc

```
    export PYTHONPATH=$(pwd)
    python grpc/server.py
```

### Структура БД

---

В базе данных SQLite имеется единственная таблица Term с полями `keyword` и `description`
1. <b>keyword</b> – ключевое слово, название самого термина
2. <b>description</b> – текстовое описание термина

### Структура проекта

---

В проекте присутствует несколько основных директорий:

1. web. Реализация сервиса при помощи методологии rest
2. grpc. Реализация сервиса при помощи технологии grpc
3. shared. Общие элементы логики и модели
4. testing. locust-тесты


### Rest API

---

Сервис, имплементирующий метологию REST, реализован при помощи:
- fastapi – фреймворк для создания api
- SQLite в качестве базы данных
- pydantic для валидации полей
- uvicorn для поднятия asgi веб-сервера

### GRPC

---

Сервис, использующий технологию grpc, написан при помощи:
- grpcio – библиотека, позволяющая использовать функционал grpc
- grpcio-tools необходим для генерации pb файлов
- grpcio-reflection позволяет использовать reflection api
- pydantic для валидации полей

### Нагрузочное тестирование

---

Тесты были написаны при помощи библиотеки locust. 

В директории testing имеется два основных файла: 

1. locust-web.py – тесты для рест
2. locust-grpc.py – тесты для grpc

Во внутренней директории config находятся конфигурации для запуска тестов с разной нагрузкой

Запуск тестов:
```
    cd testing
    locust -f locust-web.py --host=localhost:8000
    locust -f locust-grpc.py
```

> Для запуска grpc тестов нет необходимости указывать хоста, тк хост уже заранее указан при подключении канала в тестах

Результаты заранее проведенных тестов находятся в директории results

Аппаратные характеристики компьютера, на котором тестировались приложения:
- Apple M1 Pro
- 32 GB RAM
- 16 GB GPU

### Результаты проведения нагрузочного тестирования

Для каждого из сервисов было проведено по четыре тестирования с разными конфигурациями:

- Легкая нагрузка - имитация 10 пользователей с частотой их появления в 2 секунды длительностью 3 минуты
- Нормальная нагрузка - имитация 100 пользователей с частотой появления в 10 секунд длительностью 10 минут
- Стрессовая нагрузка - имитация 500 пользователей с частотой появления в 50 секунд длительностью 15 минут
- Проверка стабильности - имитация 150 пользователей с частотой появления в 5 секунд длительностью 1 час

#### Легкая нагрузка

- grpc имеет экспоненциальный рост RPS до точного значения 4.9 во время набора пользователей. 95 и 50 перцентили растут до значений 18 и 13 соответственно, после чего опускаются до 12 и 7. Ошибок на протяжении всего теста не наблюдалось.
- web в свою очередь имеет резкий рост RPS до 4.7 после чего начинается колебаться между значениями в промежутке 4.3 и 5.4. Тесты показали количество ошибок в районе 39%, что объясняется тем, что все ошибки имеютс статус 404, то есть это именно пользовательский сценарий. 50 и 95 перцентили имеют ярко выраженную корреляцию

#### Нормальная нагрузка

- grpc все еще имеет резкий рост RPS, но дальше значения уже начинают колебаться с небольшим отклонением. Ошибок все еще не наблюдается. Перцентили затухают в первую минуту тестирования, после чего стабилизируются и имеют средние значения 5 и 12, где 5 это 50 перцентиль, а 12 - 95
- web все так же имеет 36% ошибок, благодаря 404 ошибкам. Прирост RPS при этом составляет в районе 50. Перцентили аналогичны сервису на grpc

#### Стрессовая нагрузка

- у grpc рост RPS составляет до 250, но на 6 минуте тестирования резко опускается до 0, после чего снова возрастает до прежних значений, что означает, что сервис перестал на мгновение справляться с нагрузкой. Перцентили находятся в районе 2 и 8 для 50 и 95 соответственно
- у web рост RPS все такой же ровный и составляет 250, с 36% количеством ошибок. У 95 перцентиля в первые 4 минуты тестирования наблюдается высокая дисперсия, что обособляется высоким разбросом данных. В последствии значение начинает равномерно снижаться с 30 до 0. У 50 перцентиля значение на весь период тестирования составляет 3

#### Проверка стабильности

- у grpc рост наблюдается периодический рост RPS до 75, после чего спустя некоторый промежуток времени значение опускается до 0 и снова возрастает, что так же является следствием того, что сервис перестает справляться с нагрузкой. Перцентили имеют аналогичный период роста и спада, и среднее их значение составляет 4 и 10 для 50 и 95 соответственно. При этом у 95 перцентиля наблюдаются скачки значений на протяжении всего тестирования
- web в свою очередь имеет более стабильный показатель RPS в районе 75 с единичным падением до 0. При этом перцентиля на протяжении всего процесса тестирования имеют идентичные показатели равные 1 с резким ростом до 12000 и 16000 в момент падения RPS

### Заключение

При проведении нагрузочного тестирования было выявлено, что gRPC обеспечивает лучшую производительность и качество обслуживания при умеренной нагрузке, но менее устойчив к перегрузкам. Web-сервис демонстрирует большую устойчивость под экстремальными нагрузками, однако страдает от высокой доли неуспешных запросов и деградации латентности.